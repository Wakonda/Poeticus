{% extends generic_layout %}

{% block head_title %}Membre - {{ entity.username }}{% endblock %}
{% block main_title %}{{ entity.username }}{% endblock %}

{% block style_additional %}
	<link rel="stylesheet" href="{{ app.request.basepath }}/js/DataTables-1.10.0/media/css/jquery.dataTables.css" type="text/css" media="screen" />
{% endblock %}

{% block script_additional %}
	<script src="{{ app.request.basepath }}/js/DataTables-1.10.0/media/js/jquery.dataTables.js" type="text/javascript"></script>
	<script src="{{ app.request.basepath }}/js/noty-2.3.4/js/noty/packaged/jquery.noty.packaged.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		{# app.security.token.user.username|var_dump #}
		$(function ()
		{
			oTablePoem = $('table.poems_user_datatables').DataTable( {
				"oLanguage": {
					"sUrl": "{{ app.request.basepath }}/js/DataTables-1.10.0/language/dataTables.fr.txt"
				},
				"bFilter": true,
				"bInfo": true,
				"bSort": true,
				"bLengthChange": true,
				"sPaginationType": "full_numbers",
				"iDisplayLength": 15,
				"bProcessing": true,
				"bServerSide": true,
				"sAjaxSource": "{{ path('poem_user_datatables', { 'username' : entity.username }) }}"
			});
			
			$(document).on("click", ".delete_poem", function(event)
			{
				var id = $(this).data("id");
				event.preventDefault();
				var n = noty({
					layout: 'center',
					type: 'confirm',
					killer: true,
					text: 'Êtes-vous sûr de vouloir supprimer cette poésie ?',
					animation: {
						open: {height: 'toggle'}, // jQuery animate function property object
						close: {height: 'toggle'}, // jQuery animate function property object
						easing: 'swing', // easing
						speed: 500 // opening & closing animation speed
					},
					buttons: [
					{
						addClass: 'btn btn-primary', text: 'Oui', onClick: function($noty) {
						$.ajax(
						{
							type: "GET",
							url: "{{ path('poemuser_delete') }}?id=" + id,
							cache: false,
							success: function(data)
							{
								oTablePoem.ajax.reload();
							}
						});
						$noty.close();
					  }
					},
					{
						addClass: 'btn btn-danger', text: 'Annuler', onClick: function($noty) {
							$noty.close();
						}
					}
				  ]
				});
			});

			$('table.comments_user_datatables').dataTable( {
				"oLanguage": {
					"sUrl": "{{ app.request.basepath }}/js/DataTables-1.10.0/language/dataTables.fr.txt"
				},
				"bFilter": true,
				"bInfo": true,
				"bSort": true,
				"bLengthChange": true,
				"sPaginationType": "full_numbers",
				"iDisplayLength": 15,
				"bProcessing": true,
				"bServerSide": true,
				"sAjaxSource": "{{ path('poem_comment_datatables', { 'username' : entity.username }) }}"
			});
			
			$('table.votes_user_datatables').dataTable( {
				"oLanguage": {
					"sUrl": "{{ app.request.basepath }}/js/DataTables-1.10.0/language/dataTables.fr.txt"
				},
				"bFilter": true,
				"bInfo": true,
				"bSort": true,
				"bLengthChange": true,
				"sPaginationType": "full_numbers",
				"iDisplayLength": 15,
				"bProcessing": true,
				"bServerSide": true,
				"sAjaxSource": "{{ path('poem_vote_datatables', { 'username' : entity.username }) }}"
			});
		});
	</script>
{% endblock %}

{% block main_content %}
	{% for message in app.session.getFlashBag.get('new_password') %}
		<div class="success">{{ message }}</div>
	{% endfor %}
	
	<p class="center">
	{% if entity.avatar is null %}
		<img src="{{ entity.gravatar }}" alt="" id="gravatar" />
	{% else %}
		{{ ("photo/user/"~entity.avatar)|max_size_image(app.request.basepath) }}
	{% endif %}
	</p>
	<table id="user">
		<tr>
			<th>Login</th>
			<td>{{ entity.username }}</td>
		</tr>
		<tr>
			<th>Pays</th>
			<td><span>{{ entity.country.title }} <img class="flag" src="{{ app.request.basepath }}/photo/country/{{ entity.country.flag }}" alt="" height="8" /></span></td>
		</tr>
		<tr>
			<th>Présentation</th>
			<td>{{ entity.presentation|raw }}</td>
		</tr>
	</table>
	<h2 class="subtitle_show_user">Mes poésies</h2>
	<hr class="show_user_separator">
	<table class="poems_user_datatables display">
		<thead>
			<th>Titre</th>
			{% if is_granted("IS_AUTHENTICATED_REMEMBERED") and entity.username == app.security.token.user.username %}
				<th>Etat</th>
				<th>Actions</th>
			{% endif %}
		</thead>
		<tbody>
		</tbody>
	</table>
	<h2 class="subtitle_show_user">Mes commentaires</h2>
	<hr class="show_user_separator">
	<table class="comments_user_datatables display">
		<thead>
			<th>Poésie</th>
			<th>Date</th>
		</thead>
		<tbody>
		</tbody>
	</table>
	<h2 class="subtitle_show_user">Mes votes</h2>
	<hr class="show_user_separator">
	<table class="votes_user_datatables display">
		<thead>
			<th>Poésie</th>
			<th>Vote</th>
		</thead>
		<tbody>
		</tbody>
	</table>
{% endblock %}