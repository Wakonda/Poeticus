	<script src="{{ app.request.basepath }}/js/CLEditor1_3_0/jquery.cleditor.js" type="text/javascript"></script>
<link rel="stylesheet" href="{{ app.request.basepath }}/js/CLEditor1_3_0/jquery.cleditor.css" type="text/css" media="screen" />
<script type="text/javascript">
	$(function()
	{
		$("#form_comment").submit(function()
		{
			var DATA = $(this).serialize();

			$.ajax(
			{
				type: "POST",
				url: "{{ path('comment_create', { poemId: poemId }) }}?page=1",
				data: DATA,
				cache: false,
				success: function(data)
				{
					if (data.error == '') {
						$("#comment_text").val("");
						$("#list_comments").html(data.content);
						
						if($("#error_comment_text").length > 0)
							$("#error_comment_text").remove();
					}
					else
					{
						if($("#error_comment_text").length == 0)
							$(".error_message").append("<span class='error' id='error_comment_text'>" + data.error + "</span>");
					}
				}
			});
			event.preventDefault();
		});
		
		function loadComments()
		{
			$.ajax(
			{
				type: "GET",
				url: "{{ path('comment_load') }}?page=1",
				cache: false,
				success: function(data)
				{
					$("#list_comments").html(data);
				}
			});
		}
		
		$(document).on("click", ".page_action", function()
		{
			$.ajax(
			{
				type: "GET",
				url: "{{ path('comment_load') }}?page=" + $(this).data("followpage"),
				cache: false,
				success: function(data)
				{
					$("#list_comments").html(data);
				}
			});

			event.preventDefault();
		});
		
		loadComments();

		$("#comment_text").cleditor({
			width: "100%", // width not including margins, borders or padding
			height: 175, // height not including margins, borders or padding
			controls: // controls to add to the toolbar
				"bold italic underline strikethrough subscript superscript | color highlight | " +
				"link unlink",
			colors: // colors in the color popup
				"FFF FCC FC9 FF9 FFC 9F9 9FF CFF CCF FCF " +
				"CCC F66 F96 FF6 FF3 6F9 3FF 6FF 99F F9F " +
				"BBB F00 F90 FC6 FF0 3F3 6CC 3CF 66C C6C " +
				"999 C00 F60 FC3 FC0 3C0 0CC 36F 63F C3C " +
				"666 900 C60 C93 990 090 399 33F 60C 939 " +
				"333 600 930 963 660 060 366 009 339 636 " +
				"000 300 630 633 330 030 033 006 309 303",
			docType: ''
		});
	});
</script>
<hr>
<h2>Commentaires</h2>

{% if is_granted('IS_AUTHENTICATED_FULLY') == false and is_granted('IS_AUTHENTICATED_REMEMBERED') == false %}
	Vous devez être connecté pour pouvoir écrire un commentaire
{% endif %}
{% form_theme form 'Form/fields.html.twig' %}
<form action="" method="post" id="form_comment" novalidate>
	<div class="error_message"></div>
	{{ form_label(form.text) }}
	{{ form_widget(form.text) }}
	<br>
	{{ form_widget(form.save, {'icon': 'fa-commenting'}) }}
	{{ form_rest(form) }}
</form>
<br>
<div id="list_comments"></div>